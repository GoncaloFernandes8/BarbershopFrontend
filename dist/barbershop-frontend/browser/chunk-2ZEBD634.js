import{a as ae,c as re,e as se,j as le,l as ce}from"./chunk-DHFJ6J7A.js";import{a as de}from"./chunk-PEWIRK6Q.js";import{a as oe}from"./chunk-PKSYBSCW.js";import{$ as J,B as l,Ca as ne,E as S,Ea as ie,I as f,K as j,L as d,M as v,O as o,P as a,Q as L,R as U,S as q,T as _,U as u,V as m,X as r,Y as w,Z as C,_ as G,aa as K,ba as X,f as Y,fa as y,g as W,ha as Z,ia as k,j as H,oa as ee,qa as M,r as O,ra as B,s as Q,t as b,ta as F,u as h,ua as te,va as x,w as E,y as g,z as V}from"./chunk-UJJHZF2K.js";function ve(i,n){if(i&1){let e=_();U(0),o(1,"button",7),u("click",function(){let s=b(e).$implicit,c=m(2);return h(c.select(s))}),r(2),a(),q()}if(i&2){let e=n.$implicit;l(),v("out",!e.inMonth)("today",e.isToday)("disabled",e.disabled)("selected",e.selected),l(),C(" ",e.label," ")}}function ye(i,n){if(i&1&&(U(0),f(1,ve,3,9,"ng-container",6),q()),i&2){let e=n.$implicit;l(),d("ngForOf",e)}}function me(i){let n=i.getFullYear(),e=String(i.getMonth()+1).padStart(2,"0"),t=String(i.getDate()).padStart(2,"0");return`${n}-${e}-${t}`}function z(i){let[n,e]=i.split("-").map(Number);return new Date(n,e-1,1)}var N=class i{month;selectedDate;minDate;disableSundays=!0;locale="pt-PT";timezone="Europe/Lisbon";monthChange=new E;selectDate=new E;get monthDate(){return z(this.month)}get weeks(){let n=z(this.month),e=new Date(n.getFullYear(),n.getMonth(),1),t=me(new Date),s=this.minDate??t,c=new Date(e),A=(e.getDay()+6)%7;c.setDate(e.getDate()-A);let P=[];for(let p=0;p<42;p++){let D=new Date(c);D.setDate(c.getDate()+p);let T=me(D),be=T===t,he=D.getMonth()===n.getMonth(),_e=D.getDay()===0,Ce=this.disableSundays&&_e||T<s;P.push({dateStr:T,label:D.getDate(),inMonth:he,disabled:Ce,isToday:be,selected:this.selectedDate===T})}let I=[];for(let p=0;p<P.length;p+=7)I.push(P.slice(p,p+7));return I}prevMonth(){let n=z(this.month);n.setMonth(n.getMonth()-1);let e=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`;this.monthChange.emit(e)}nextMonth(){let n=z(this.month);n.setMonth(n.getMonth()+1);let e=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`;this.monthChange.emit(e)}select(n){n.disabled||this.selectDate.emit(n.dateStr)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=S({type:i,selectors:[["app-calendar-month"]],inputs:{month:"month",selectedDate:"selectedDate",minDate:"minDate",disableSundays:"disableSundays",locale:"locale",timezone:"timezone"},outputs:{monthChange:"monthChange",selectDate:"selectDate"},decls:26,vars:7,consts:[[1,"cal"],[1,"cal-head"],["type","button",1,"btn",3,"click"],[1,"title"],[1,"cal-grid","cal-weekdays"],[1,"cal-grid"],[4,"ngFor","ngForOf"],["type","button",1,"day",3,"click"]],template:function(e,t){e&1&&(o(0,"div",0)(1,"div",1)(2,"button",2),u("click",function(){return t.prevMonth()}),r(3,"\u2039"),a(),o(4,"div",3),r(5),y(6,"date"),a(),o(7,"button",2),u("click",function(){return t.nextMonth()}),r(8,"\u203A"),a()(),o(9,"div",4)(10,"div"),r(11,"Seg"),a(),o(12,"div"),r(13,"Ter"),a(),o(14,"div"),r(15,"Qua"),a(),o(16,"div"),r(17,"Qui"),a(),o(18,"div"),r(19,"Sex"),a(),o(20,"div"),r(21,"S\xE1b"),a(),o(22,"div"),r(23,"Dom"),a()(),o(24,"div",5),f(25,ye,2,1,"ng-container",6),a()()),e&2&&(l(5),C(" ",k(6,2,t.monthDate,"MMMM yyyy",t.timezone,t.locale)," "),l(20),d("ngForOf",t.weeks))},dependencies:[x,M,F],styles:[".cal[_ngcontent-%COMP%]{display:grid;gap:.6rem}.cal-head[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.cal-head[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{text-transform:capitalize;font-weight:700}.cal-head[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-radius:10px;border:1px solid #2a3042;background:#12141a;padding:.3rem .6rem;cursor:pointer}.cal-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(7,1fr);gap:.35rem}.cal-weekdays[_ngcontent-%COMP%]{color:#a0a7b4;font-size:.9rem}.day[_ngcontent-%COMP%]{aspect-ratio:1/1;border-radius:12px;border:1px solid #2b3143;background:#11141a;color:#e9eef7;cursor:pointer}.day[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}.day.out[_ngcontent-%COMP%]{opacity:.45}.day.disabled[_ngcontent-%COMP%]{opacity:.35;cursor:not-allowed;filter:grayscale(1)}.day.today[_ngcontent-%COMP%]{outline:1px dashed #3c445e}.day.selected[_ngcontent-%COMP%]{background:#1a1d27;border-color:#3a4157;box-shadow:inset 0 0 0 2px #c3ff5a59}"]})};function Se(i,n){i&1&&(o(0,"div",6)(1,"div",7)(2,"span",8),r(3,"A carregar\u2026"),a()()())}function Me(i,n){if(i&1){let e=_();o(0,"button",11),u("click",function(){let s=b(e).$implicit,c=m(2);return h(c.onPick(s.iso))}),r(1),y(2,"date"),a()}if(i&2){let e=n.$implicit,t=m(2);v("active",e.iso===t.selected),l(),C(" ",k(2,3,e.date,"HH:mm",t.timezone,t.locale)," ")}}function xe(i,n){if(i&1&&(o(0,"div",9),f(1,Me,3,8,"button",10),a()),i&2){let e=m();l(),d("ngForOf",e.slotItems)}}function Pe(i,n){i&1&&(o(0,"p",12),r(1," Sem hor\xE1rios dispon\xEDveis neste dia. "),a())}var $=class i{date;slots;loading=!1;selected;locale="pt-PT";timezone="Europe/Lisbon";select=new E;slotItems=[];get dateObj(){return new Date(`${this.date}T12:00:00`)}ngOnChanges(n){(n.slots||n.date)&&(this.slotItems=(this.slots??[]).map(e=>{let t=new Date(e);return isNaN(t.getTime())&&(t=new Date(`${this.date}T${e}:00`)),{iso:e,date:t}}))}onPick(n){this.select.emit(n)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=S({type:i,selectors:[["app-time-slots"]],inputs:{date:"date",slots:"slots",loading:"loading",selected:"selected",locale:"locale",timezone:"timezone"},outputs:{select:"select"},features:[Q],decls:12,vars:9,consts:[[1,"slots"],[1,"slots-head"],[1,"muted",2,"font-size",".9rem"],["class","loading",4,"ngIf"],["class","grid",4,"ngIf"],["class","muted",4,"ngIf"],[1,"loading"],["role","status","aria-live","polite","aria-label","A carregar hor\xE1rios",1,"spinner"],[1,"sr-only"],[1,"grid"],["type","button","class","slot",3,"active","click",4,"ngFor","ngForOf"],["type","button",1,"slot",3,"click"],[1,"muted"]],template:function(e,t){e&1&&(o(0,"div",0)(1,"div",1)(2,"div")(3,"div",2),r(4,"Dia"),a(),o(5,"div")(6,"strong"),r(7),y(8,"date"),a()()()(),f(9,Se,4,0,"div",3)(10,xe,2,1,"div",4)(11,Pe,2,0,"p",5),a()),e&2&&(l(7),w(k(8,4,t.dateObj,"EEEE, d 'de' MMMM",t.timezone,t.locale)),l(2),d("ngIf",t.loading),l(),d("ngIf",!t.loading&&t.slotItems.length>0),l(),d("ngIf",!t.loading&&t.slotItems.length===0))},dependencies:[x,M,B,F],styles:[".slots[_ngcontent-%COMP%]{display:grid;gap:.6rem}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:.5rem}@media (max-width:920px){.grid[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}}.slot[_ngcontent-%COMP%]{padding:.7rem .8rem;border-radius:10px;border:1px solid #2b3143;background:#11141a;color:#e9eef7;cursor:pointer}.slot.active[_ngcontent-%COMP%]{background:#1a1d27;border-color:#3a4157;box-shadow:inset 0 0 0 2px #c3ff5a59}.slots[_ngcontent-%COMP%]{position:relative}.loading[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:1.5rem}.spinner[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;border:3px solid rgba(195,255,90,.25);border-top-color:#c3ff5a;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.sr-only[_ngcontent-%COMP%]{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}"]})};function De(i,n){if(i&1){let e=_();o(0,"button",15),u("click",function(){let s=b(e).$implicit,c=m();return h(c.onPickService(s.id))}),L(1,"img",16),o(2,"div",17)(3,"div",18),r(4),a(),o(5,"div",19),r(6),y(7,"number"),a()()()}if(i&2){let e=n.$implicit,t=m();v("selected",t.selectedServiceId()===e.id),j("aria-pressed",t.selectedServiceId()===e.id?"true":"false"),l(),d("src",t.getServiceImg(e),V)("alt",e.name),l(3),w(e.name),l(2),G(" ",e.durationMin," min \xB7 ",Z(7,8,e.priceCents/100,"1.2-2","pt-PT")," \u20AC ")}}function Oe(i,n){if(i&1){let e=_();o(0,"button",20),u("click",function(){let s=b(e).$implicit,c=m();return h(c.onPickBarber(s.id))}),L(1,"img",21),o(2,"div",17)(3,"div",18),r(4),a(),o(5,"div",19),r(6,"Barbeiro"),a()()()}if(i&2){let e=n.$implicit,t=m();v("selected",t.selectedBarberId()===e.id),j("aria-pressed",t.selectedBarberId()===e.id?"true":"false"),l(),d("src",t.getBarberImg(e),V)("alt",e.name),l(3),w(e.name)}}function Ee(i,n){if(i&1){let e=_();o(0,"app-time-slots",22),u("select",function(s){b(e);let c=m();return h(c.onPickSlot(s))}),a()}if(i&2){let e=n.ngIf,t=m();d("date",e)("slots",t.slots())("selected",t.selectedSlot()||void 0)("timezone","Europe/Lisbon")("locale","pt-PT")("loading",t.loadingSlots())}}var fe=class i{api=O(de);auth=O(oe);router=O(ie);route=O(ne);submitting=g(!1);notes="";services=g([]);barbers=g([]);selectedServiceId=g(null);selectedBarberId=g(null);todayYmd=we(new Date);month=g(this.todayYmd.slice(0,7));selectedDate=g(this.todayYmd);slots=g([]);selectedSlot=g(null);loadingSlots=g(!1);note=g(null);ngOnInit(){let n=this.api.getBarbers().pipe(Y(t=>t.filter(s=>s.active))),e=this.api.getServices().pipe(Y(t=>t.filter(s=>s.active)));W([n,e]).subscribe(([t,s])=>{this.barbers.set(t),this.services.set(s);let c=this.route.snapshot.queryParamMap,R=Number(c.get("servico")),A=Number(c.get("barbeiro")),P=s.find(p=>p.id===R)?.id??s[0]?.id??null,I=t.find(p=>p.id===A)?.id??t[0]?.id??null;this.selectedServiceId.set(P),this.selectedBarberId.set(I),this.selectedSlot.set(null),this.loadAvailability()})}onMonthChange(n){this.month.set(n)}onSelectDate(n){this.selectedDate.set(n),this.selectedSlot.set(null),this.loadAvailability()}onPickSlot(n){this.selectedSlot.set(n),this.note.set(null)}loadAvailability(){let n=this.selectedBarberId(),e=this.selectedServiceId(),t=this.selectedDate();!n||!e||!t||(this.loadingSlots.set(!0),this.api.getAvailability(n,e,t).subscribe({next:s=>{this.slots.set(s),this.loadingSlots.set(!1)},error:()=>{this.slots.set([]),this.loadingSlots.set(!1)}}))}canSubmit=ee(()=>!!this.selectedBarberId()&&!!this.selectedServiceId()&&!!this.selectedDate()&&!!this.selectedSlot());book(){if(!this.canSubmit())return;let n=this.auth.user;if(!n?.id){this.note.set("Tens de iniciar sess\xE3o para marcar.");return}this.submitting.set(!0),this.note.set(null),this.api.createAppointment({barberId:this.selectedBarberId(),serviceId:this.selectedServiceId(),clientId:Number(n.id),startsAt:this.selectedSlot(),notes:this.notes.trim()||void 0}).pipe(H(()=>this.submitting.set(!1))).subscribe({next:e=>{this.notes="",this.router.navigate(["/sucesso",e])},error:e=>{this.note.set(e?.status===409?"Esse hor\xE1rio ficou indispon\xEDvel. Escolhe outro, por favor.":e?.message||"N\xE3o foi poss\xEDvel criar a marca\xE7\xE3o."),console.error("Falha ao criar marca\xE7\xE3o:",e)}})}onPickService(n){this.selectedServiceId()!==n&&(this.selectedServiceId.set(n),this.selectedSlot.set(null),this.loadAvailability())}onPickBarber(n){this.selectedBarberId()!==n&&(this.selectedBarberId.set(n),this.selectedSlot.set(null),this.loadAvailability())}getServiceImg(n){let e=n.name.toLowerCase();return e.includes("corte e barba")?"assets/services/corte-barba.png":e.includes("barba")?"assets/services/barba.png":e.includes("crian")?"assets/services/crianca.png":e.includes("corte")?"assets/services/corte.png":"assets/services/servico.png"}getBarberImg(n){return`assets/barbers/${n.id}.png`}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=S({type:i,selectors:[["app-booking"]],decls:27,vars:11,consts:[[1,"booking"],[1,"muted"],[1,"section-title"],[1,"cards"],["type","button","class","card service",3,"selected","click",4,"ngFor","ngForOf"],["type","button","class","card barber",3,"selected","click",4,"ngFor","ngForOf"],[1,"grid-2"],[3,"monthChange","selectDate","month","selectedDate","minDate","disableSundays"],[3,"date","slots","selected","timezone","locale","loading","select",4,"ngIf"],[1,"note-field"],["for","note"],["id","note","rows","2","maxlength","200","placeholder","Ex.: prefiro degrad\xEA, aten\xE7\xE3o \xE0 pele sens\xEDvel...",3,"ngModelChange","ngModel"],[1,"charcount"],[1,"actions"],[1,"btn","accent","cta",3,"click","disabled"],["type","button",1,"card","service",3,"click"],[1,"thumb",3,"src","alt"],[1,"card-body"],[1,"card-title"],[1,"card-meta"],["type","button",1,"card","barber",3,"click"],[1,"avatar",3,"src","alt"],[3,"select","date","slots","selected","timezone","locale","loading"]],template:function(e,t){e&1&&(o(0,"section",0)(1,"h1"),r(2,"Fazer marca\xE7\xE3o"),a(),o(3,"p",1),r(4,"Escolhe o servi\xE7o, o barbeiro e reserva rapidamente no calend\xE1rio."),a(),o(5,"h3",2),r(6,"Escolhe o servi\xE7o"),a(),o(7,"div",3),f(8,De,8,12,"button",4),a(),o(9,"h3",2),r(10,"Escolhe o barbeiro"),a(),o(11,"div",3),f(12,Oe,7,6,"button",5),a(),o(13,"div",6)(14,"app-calendar-month",7),u("monthChange",function(c){return t.onMonthChange(c)})("selectDate",function(c){return t.onSelectDate(c)}),a(),f(15,Ee,1,6,"app-time-slots",8),a(),o(16,"div",9)(17,"label",10),r(18,"Notas "),o(19,"span",1),r(20,"(opcional)"),a()(),o(21,"textarea",11),X("ngModelChange",function(c){return K(t.notes,c)||(t.notes=c),c}),a(),o(22,"div",12),r(23),a()(),o(24,"div",13)(25,"button",14),u("click",function(){return t.book()}),r(26),a()()()),e&2&&(l(8),d("ngForOf",t.services()),l(4),d("ngForOf",t.barbers()),l(2),d("month",t.month())("selectedDate",t.selectedDate()||void 0)("minDate",t.todayYmd)("disableSundays",!0),l(),d("ngIf",t.selectedDate()),l(6),J("ngModel",t.notes),l(2),C("",(t.notes||"").length,"/200"),l(2),d("disabled",!t.canSubmit()||t.submitting()),l(),C(" ",t.submitting()?"A confirmar\u2026":"Confirmar marca\xE7\xE3o",`
`))},dependencies:[x,M,B,te,ce,ae,re,le,se,N,$],styles:['.grid2[_ngcontent-%COMP%]{display:grid;grid-template-columns:1.1fr 1fr;gap:1rem}@media (max-width: 1020px){.grid2[_ngcontent-%COMP%]{grid-template-columns:1fr}}.form[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{margin-top:.2rem}.row[_ngcontent-%COMP%]{display:flex;gap:1rem;flex-wrap:wrap}.field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem;min-width:220px}.grid-2[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem}.actions[_ngcontent-%COMP%]{margin-top:4rem}.welcome[_ngcontent-%COMP%]{margin-left:.5rem}.section-title[_ngcontent-%COMP%]{margin:1rem 0 .5rem;font-size:1.1rem}.cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:.75rem;margin-bottom:1rem}.card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem;border:2px solid transparent;border-radius:16px;background:#111;cursor:pointer;transition:transform .12s ease,border-color .12s ease,box-shadow .12s ease;text-align:left}.card[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}.card.selected[_ngcontent-%COMP%]{border-color:#c3ff5a;box-shadow:0 0 0 4px #c3ff5a26;background:#141914}.card[_ngcontent-%COMP%]   .thumb[_ngcontent-%COMP%]{width:42px;height:42px;object-fit:contain}.card[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:42px;height:42px;border-radius:999px;object-fit:cover;background:#222}.card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.card[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{font-weight:600}.card[_ngcontent-%COMP%]   .card-meta[_ngcontent-%COMP%]{font-size:.85rem;color:#aaa}.grid-2[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;align-items:start;justify-items:stretch;margin-bottom:4rem}@media (max-width: 900px){.grid-2[_ngcontent-%COMP%]{grid-template-columns:1fr}}.booking[_ngcontent-%COMP%]{padding-bottom:4rem}.booking[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:1.5rem 0 3rem}.btn.cta[_ngcontent-%COMP%]{padding:1.1rem 1.8rem;font-size:1.1rem;font-weight:800;letter-spacing:.2px;border-radius:14px;min-width:240px;-webkit-font-smoothing:antialiased;transition:transform .12s ease,box-shadow .15s ease,filter .2s ease}.btn.accent.cta[_ngcontent-%COMP%]{background:var(--accent);color:#111;border:0;box-shadow:0 10px 24px #c3ff5a40}.btn.accent.cta[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 14px 32px #c3ff5a4d}.btn.accent.cta[_ngcontent-%COMP%]:active{transform:translateY(0)}.btn.accent.cta[_ngcontent-%COMP%]:disabled{cursor:not-allowed;filter:grayscale(.6);opacity:.7;box-shadow:none}.btn.cta[_ngcontent-%COMP%]{font-family:Manrope,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Noto Sans,Arial,"Apple Color Emoji","Segoe UI Emoji"}.note-field[_ngcontent-%COMP%]{margin-top:1rem;display:grid;gap:.4rem}.note-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:vertical;min-height:64px}.note-field[_ngcontent-%COMP%]   .charcount[_ngcontent-%COMP%]{text-align:right;font-size:.85rem;color:var(--muted)}']})};function we(i){let n=i.getFullYear(),e=String(i.getMonth()+1).padStart(2,"0"),t=String(i.getDate()).padStart(2,"0");return`${n}-${e}-${t}`}export{fe as BookingComponent};
