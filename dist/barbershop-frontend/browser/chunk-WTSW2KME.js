import{Aa as g,Ba as h,Ia as f,f as d,k as s,n as a,q as l,t as n}from"./chunk-VTAVQ2BQ.js";var m={production:!0,apiUrl:"https://due-constancia-goncalo-6b7726ec.koyeb.app",frontendUrl:"https://barbershop-frontend-nine.vercel.app"};var p=class o{notifications=[];router=n(f);authService=n(c);handleError(e){let r="Ocorreu um erro inesperado.",t;if(e.error instanceof ErrorEvent)r=e.error.message;else{let i=e.error;if(i)r=i.message||r,t=i.fieldErrors;else switch(e.status){case 0:r="Erro de conex\xE3o. Verifique sua internet e tente novamente.";break;case 400:r="Dados inv\xE1lidos. Verifique as informa\xE7\xF5es inseridas.";break;case 401:return this.handleTokenExpiration(),d(()=>e);case 403:r="Acesso negado. Voc\xEA n\xE3o tem permiss\xE3o para esta a\xE7\xE3o.";break;case 404:r="Recurso n\xE3o encontrado.";break;case 409:r="Conflito de dados. Esta informa\xE7\xE3o j\xE1 existe.";break;case 422:r="Dados de valida\xE7\xE3o inv\xE1lidos. Verifique os campos destacados.";break;case 429:r="Muitas tentativas. Aguarde um momento e tente novamente.";break;case 500:r="Erro interno do servidor. Tente novamente mais tarde.";break;case 503:r="Servi\xE7o temporariamente indispon\xEDvel. Tente novamente em alguns minutos.";break;default:e.status>=500?r="Erro do servidor. Tente novamente mais tarde.":e.status>=400?r="Erro na requisi\xE7\xE3o. Verifique os dados e tente novamente.":r=`Erro ${e.status}: ${e.statusText}`}}let u=new g({error:{message:r,fieldErrors:t},status:e.status,statusText:e.statusText});return d(()=>u)}getFieldError(e,r){return e?.[r]||null}hasFieldErrors(e){return e?Object.keys(e).length>0:!1}showError(e){this.showNotification(e,"error")}showSuccess(e){this.showNotification(e,"success")}showWarning(e){this.showNotification(e,"warning")}showInfo(e){this.showNotification(e,"info")}showNotification(e,r){let t=document.createElement("div");t.className=`notification notification-${r}`,t.textContent=e,Object.assign(t.style,{position:"fixed",top:"20px",left:"50%",transform:"translateX(-50%) translateY(-100%)",padding:"16px 24px",borderRadius:"12px",fontWeight:"600",fontSize:"14px",zIndex:"9999",maxWidth:"500px",width:"90%",wordWrap:"break-word",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)",transition:"transform 0.4s cubic-bezier(0.4, 0, 0.2, 1)",textAlign:"center",border:"2px solid transparent"});let u={error:"#ef4444",success:"#C3FF5A",warning:"#f59e0b",info:"#3b82f6"},i={error:"white",success:"#0f0f11",warning:"white",info:"white"};t.style.backgroundColor=u[r],t.style.color=i[r],document.body.appendChild(t),setTimeout(()=>{t.style.transform="translateX(-50%) translateY(0)"},100),setTimeout(()=>{t.style.transform="translateX(-50%) translateY(-100%)",setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},400)},5e3)}getNotifications(){return[...this.notifications]}clearNotifications(){this.notifications=[]}handleTokenExpiration(){this.authService.clearAuth(),this.showError("Sess\xE3o expirada. Por favor, fa\xE7a login novamente."),setTimeout(()=>{this.router.navigate(["/login"])},2e3)}static \u0275fac=function(r){return new(r||o)};static \u0275prov=l({token:o,factory:o.\u0275fac,providedIn:"root"})};var c=class o{http=n(h);errorHandler=n(p);API=m.apiUrl;login(e){return this.http.post(`${this.API}/auth/login`,e).pipe(a(r=>{localStorage.setItem("token",r.token),localStorage.setItem("refresh_token",r.refreshToken),localStorage.setItem("user",JSON.stringify(r.user)),this.errorHandler.showSuccess("Login realizado com sucesso!")}),s(r=>(this.errorHandler.showError("Erro ao fazer login. Verifique suas credenciais."),this.errorHandler.handleError(r))))}register(e){return this.http.post(`${this.API}/auth/register`,e).pipe(a(()=>{this.errorHandler.showSuccess("Conta criada com sucesso! Verifique seu email.")}),s(r=>(this.errorHandler.showError("Erro ao criar conta. Tente novamente."),this.errorHandler.handleError(r))))}verifyEmail(e){return this.http.post(`${this.API}/auth/verify`,{token:e}).pipe(s(r=>this.errorHandler.handleError(r)))}resendVerification(e){return this.http.post(`${this.API}/auth/verify/resend`,{email:e}).pipe(s(r=>this.errorHandler.handleError(r)))}refreshToken(){let e=localStorage.getItem("refresh_token");if(!e)throw new Error("No refresh token available");return this.http.post(`${this.API}/auth/refresh`,{refreshToken:e}).pipe(a(r=>{localStorage.setItem("token",r.token),localStorage.setItem("refresh_token",r.refreshToken),localStorage.setItem("user",JSON.stringify(r.user))}),s(r=>(this.logout(),this.errorHandler.handleError(r))))}logout(){localStorage.removeItem("token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user"),this.errorHandler.showInfo("Sess\xE3o encerrada com sucesso.")}get user(){let e=localStorage.getItem("user");return e?JSON.parse(e):null}get isApproved(){let e=this.user;return!!e&&(e.status??"APPROVED")==="APPROVED"}get isLoggedIn(){return!!localStorage.getItem("token")&&!!this.user}isTokenExpired(){let e=localStorage.getItem("token");if(!e)return!0;try{let r=JSON.parse(atob(e.split(".")[1])),t=Math.floor(Date.now()/1e3);return r.exp<t}catch{return!0}}clearAuth(){localStorage.removeItem("token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user")}static \u0275fac=function(r){return new(r||o)};static \u0275prov=l({token:o,factory:o.\u0275fac,providedIn:"root"})};export{m as a,p as b,c};
