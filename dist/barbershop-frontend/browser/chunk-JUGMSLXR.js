import{a as l}from"./chunk-IFE72Z7Y.js";import{Ba as p,f as r,k as o,n,q as i,t as a}from"./chunk-VTAVQ2BQ.js";var g=class s{http=a(p);API=l.apiUrl;login(t){return this.http.post(`${this.API}/auth/login`,t).pipe(n(e=>{localStorage.setItem("token",e.token),localStorage.setItem("refresh_token",e.refreshToken),localStorage.setItem("user",JSON.stringify(e.user))}),o(e=>r(()=>e)))}register(t){return this.http.post(`${this.API}/auth/register`,t).pipe(o(e=>r(()=>e)))}verifyEmail(t){return this.http.post(`${this.API}/auth/verify`,{token:t}).pipe(o(e=>r(()=>e)))}resendVerification(t){return this.http.post(`${this.API}/auth/verify/resend`,{email:t}).pipe(o(e=>r(()=>e)))}refreshToken(){let t=localStorage.getItem("refresh_token");if(!t)throw new Error("No refresh token available");return this.http.post(`${this.API}/auth/refresh`,{refreshToken:t}).pipe(n(e=>{localStorage.setItem("token",e.token),localStorage.setItem("refresh_token",e.refreshToken),localStorage.setItem("user",JSON.stringify(e.user))}),o(e=>(this.logout(),r(()=>e))))}logout(){localStorage.removeItem("token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user")}get user(){let t=localStorage.getItem("user");return t?JSON.parse(t):null}get isApproved(){let t=this.user;return!!t&&(t.status??"APPROVED")==="APPROVED"}get isLoggedIn(){return!!localStorage.getItem("token")&&!!this.user}isTokenExpired(){let t=localStorage.getItem("token");if(!t)return!0;try{let e=JSON.parse(atob(t.split(".")[1])),u=Math.floor(Date.now()/1e3);return e.exp<u}catch{return!0}}clearAuth(){localStorage.removeItem("token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user")}static \u0275fac=function(e){return new(e||s)};static \u0275prov=i({token:s,factory:s.\u0275fac,providedIn:"root"})};export{g as a};
