import{a as re,c as se,e as le,j as ce,l as de}from"./chunk-WHF2TWKE.js";import{a as me}from"./chunk-VKKMDY3T.js";import{a as ae}from"./chunk-LVDKNU2I.js";import"./chunk-ID5D7IBA.js";import{$ as C,A as g,B as L,D as r,G as S,Ga as ie,Ia as oe,K as m,M as U,N as c,O as h,Q as o,R as a,S as E,T as q,U as R,V as v,W as f,X as p,Z as s,_ as w,aa as J,ba as K,ca as X,da as Z,fa as W,g as j,h as Q,ha as y,ja as ee,ka as I,l as F,qa as te,sa as x,t as D,ta as z,u as G,v as _,va as N,w as b,wa as ne,xa as M,y as k}from"./chunk-VTAVQ2BQ.js";function ye(i,t){if(i&1){let e=v();q(0),o(1,"button",7),f("click",function(){let l=_(e).$implicit,d=p(2);return b(d.select(l))}),s(2),a(),R()}if(i&2){let e=t.$implicit;r(),h("out",!e.inMonth)("today",e.isToday)("disabled",e.disabled)("selected",e.selected),r(),C(" ",e.label," ")}}function Se(i,t){if(i&1&&(q(0),m(1,ye,3,9,"ng-container",6),R()),i&2){let e=t.$implicit;r(),c("ngForOf",e)}}function pe(i){let t=i.getFullYear(),e=String(i.getMonth()+1).padStart(2,"0"),n=String(i.getDate()).padStart(2,"0");return`${t}-${e}-${n}`}function $(i){let[t,e]=i.split("-").map(Number);return new Date(t,e-1,1)}var A=class i{month;selectedDate;minDate;disableSundays=!0;locale="pt-PT";timezone="Europe/Lisbon";monthChange=new k;selectDate=new k;get monthDate(){return $(this.month)}get weeks(){let t=$(this.month),e=new Date(t.getFullYear(),t.getMonth(),1),n=pe(new Date),l=this.minDate??n,d=new Date(e),V=(e.getDay()+6)%7;d.setDate(e.getDate()-V);let P=[];for(let u=0;u<42;u++){let O=new Date(d);O.setDate(d.getDate()+u);let B=pe(O),be=B===n,he=O.getMonth()===t.getMonth(),ve=O.getDay()===0,Ce=this.disableSundays&&ve||B<l;P.push({dateStr:B,label:O.getDate(),inMonth:he,disabled:Ce,isToday:be,selected:this.selectedDate===B})}let T=[];for(let u=0;u<P.length;u+=7)T.push(P.slice(u,u+7));return T}prevMonth(){let t=$(this.month);t.setMonth(t.getMonth()-1);let e=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`;this.monthChange.emit(e)}nextMonth(){let t=$(this.month);t.setMonth(t.getMonth()+1);let e=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`;this.monthChange.emit(e)}select(t){t.disabled||this.selectDate.emit(t.dateStr)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=S({type:i,selectors:[["app-calendar-month"]],inputs:{month:"month",selectedDate:"selectedDate",minDate:"minDate",disableSundays:"disableSundays",locale:"locale",timezone:"timezone"},outputs:{monthChange:"monthChange",selectDate:"selectDate"},decls:26,vars:7,consts:[[1,"cal"],[1,"cal-head"],["type","button",1,"btn",3,"click"],[1,"title"],[1,"cal-grid","cal-weekdays"],[1,"cal-grid"],[4,"ngFor","ngForOf"],["type","button",1,"day",3,"click"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"div",1)(2,"button",2),f("click",function(){return n.prevMonth()}),s(3,"\u2039"),a(),o(4,"div",3),s(5),y(6,"date"),a(),o(7,"button",2),f("click",function(){return n.nextMonth()}),s(8,"\u203A"),a()(),o(9,"div",4)(10,"div"),s(11,"Seg"),a(),o(12,"div"),s(13,"Ter"),a(),o(14,"div"),s(15,"Qua"),a(),o(16,"div"),s(17,"Qui"),a(),o(18,"div"),s(19,"Sex"),a(),o(20,"div"),s(21,"S\xE1b"),a(),o(22,"div"),s(23,"Dom"),a()(),o(24,"div",5),m(25,Se,2,1,"ng-container",6),a()()),e&2&&(r(5),C(" ",I(6,2,n.monthDate,"MMMM yyyy",n.timezone,n.locale)," "),r(20),c("ngForOf",n.weeks))},dependencies:[M,x,N],styles:[".cal[_ngcontent-%COMP%]{display:grid;gap:.6rem}.cal-head[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.cal-head[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{text-transform:capitalize;font-weight:700}.cal-head[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-radius:10px;border:1px solid #2a3042;background:#12141a;padding:.3rem .6rem;cursor:pointer}.cal-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(7,1fr);gap:.35rem}.cal-weekdays[_ngcontent-%COMP%]{color:#a0a7b4;font-size:.9rem}.day[_ngcontent-%COMP%]{aspect-ratio:1/1;border-radius:12px;border:1px solid #2b3143;background:#11141a;color:#e9eef7;cursor:pointer}.day[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}.day.out[_ngcontent-%COMP%]{opacity:.45}.day.disabled[_ngcontent-%COMP%]{opacity:.35;cursor:not-allowed;filter:grayscale(1)}.day.today[_ngcontent-%COMP%]{outline:1px dashed #3c445e}.day.selected[_ngcontent-%COMP%]{background:#1a1d27;border-color:#3a4157;box-shadow:inset 0 0 0 2px #c3ff5a59}"]})};function xe(i,t){i&1&&(o(0,"div",6)(1,"div",7)(2,"span",8),s(3,"A carregar\u2026"),a()()())}function Me(i,t){if(i&1){let e=v();o(0,"button",11),f("click",function(){let l=_(e).$implicit,d=p(2);return b(d.onPick(l.iso))}),s(1),y(2,"date"),a()}if(i&2){let e=t.$implicit,n=p(2);h("active",e.iso===n.selected),r(),C(" ",I(2,3,e.date,"HH:mm",n.timezone,n.locale)," ")}}function Pe(i,t){if(i&1&&(o(0,"div",9),m(1,Me,3,8,"button",10),a()),i&2){let e=p();r(),c("ngForOf",e.slotItems)}}function Oe(i,t){i&1&&(o(0,"p",12),s(1," Sem hor\xE1rios dispon\xEDveis neste dia. "),a())}var Y=class i{date;slots;loading=!1;selected;locale="pt-PT";timezone="Europe/Lisbon";select=new k;slotItems=[];get dateObj(){return new Date(`${this.date}T12:00:00`)}ngOnChanges(t){(t.slots||t.date)&&(this.slotItems=(this.slots??[]).map(e=>{let n=new Date(e);return isNaN(n.getTime())&&(n=new Date(`${this.date}T${e}:00`)),{iso:e,date:n}}))}onPick(t){this.select.emit(t)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=S({type:i,selectors:[["app-time-slots"]],inputs:{date:"date",slots:"slots",loading:"loading",selected:"selected",locale:"locale",timezone:"timezone"},outputs:{select:"select"},features:[G],decls:12,vars:9,consts:[[1,"slots"],[1,"slots-head"],[1,"muted",2,"font-size",".9rem"],["class","loading",4,"ngIf"],["class","grid",4,"ngIf"],["class","muted",4,"ngIf"],[1,"loading"],["role","status","aria-live","polite","aria-label","A carregar hor\xE1rios",1,"spinner"],[1,"sr-only"],[1,"grid"],["type","button","class","slot",3,"active","click",4,"ngFor","ngForOf"],["type","button",1,"slot",3,"click"],[1,"muted"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"div",1)(2,"div")(3,"div",2),s(4,"Dia"),a(),o(5,"div")(6,"strong"),s(7),y(8,"date"),a()()()(),m(9,xe,4,0,"div",3)(10,Pe,2,1,"div",4)(11,Oe,2,0,"p",5),a()),e&2&&(r(7),w(I(8,4,n.dateObj,"EEEE, d 'de' MMMM",n.timezone,n.locale)),r(2),c("ngIf",n.loading),r(),c("ngIf",!n.loading&&n.slotItems.length>0),r(),c("ngIf",!n.loading&&n.slotItems.length===0))},dependencies:[M,x,z,N],styles:[".slots[_ngcontent-%COMP%]{display:grid;gap:.6rem}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:.5rem}@media (max-width:920px){.grid[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}}.slot[_ngcontent-%COMP%]{padding:.7rem .8rem;border-radius:10px;border:1px solid #2b3143;background:#11141a;color:#e9eef7;cursor:pointer}.slot.active[_ngcontent-%COMP%]{background:#1a1d27;border-color:#3a4157;box-shadow:inset 0 0 0 2px #c3ff5a59}.slots[_ngcontent-%COMP%]{position:relative}.loading[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:1.5rem}.spinner[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;border:3px solid rgba(195,255,90,.25);border-top-color:#c3ff5a;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.sr-only[_ngcontent-%COMP%]{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}"]})};var De=()=>[1,2,3],ke=()=>[1,2];function Ee(i,t){i&1&&(o(0,"div",17),E(1,"div",18)(2,"div",19)(3,"div",20),a())}function we(i,t){i&1&&(o(0,"div",15),m(1,Ee,4,0,"div",16),a()),i&2&&(r(),c("ngForOf",W(1,De)))}function Ie(i,t){if(i&1){let e=v();o(0,"button",23),f("click",function(){let l=_(e).$implicit,d=p(2);return b(d.onPickService(l.id))}),E(1,"img",24),o(2,"div",25)(3,"div",26),s(4),a(),o(5,"div",27),s(6),y(7,"number"),a()()()}if(i&2){let e=t.$implicit,n=p(2);h("selected",n.selectedServiceId()===e.id),U("aria-pressed",n.selectedServiceId()===e.id?"true":"false"),r(),c("src",n.getServiceImg(e),L)("alt",e.name),r(3),w(e.name),r(2),J(" ",e.durationMin," min \xB7 ",ee(7,8,e.priceCents/100,"1.2-2","pt-PT")," \u20AC ")}}function Te(i,t){if(i&1&&(o(0,"div",21),m(1,Ie,8,12,"button",22),a()),i&2){let e=p();r(),c("ngForOf",e.services())}}function Be(i,t){i&1&&(o(0,"div",17),E(1,"div",18)(2,"div",19)(3,"div",20),a())}function Fe(i,t){i&1&&(o(0,"div",15),m(1,Be,4,0,"div",16),a()),i&2&&(r(),c("ngForOf",W(1,ke)))}function ze(i,t){if(i&1){let e=v();o(0,"button",29),f("click",function(){let l=_(e).$implicit,d=p(2);return b(d.onPickBarber(l.id))}),E(1,"img",30),o(2,"div",25)(3,"div",26),s(4),a(),o(5,"div",27),s(6,"Barbeiro"),a()()()}if(i&2){let e=t.$implicit,n=p(2);h("selected",n.selectedBarberId()===e.id),U("aria-pressed",n.selectedBarberId()===e.id?"true":"false"),r(),c("src",n.getBarberImg(e),L)("alt",e.name),r(3),w(e.name)}}function Ne(i,t){if(i&1&&(o(0,"div",21),m(1,ze,7,6,"button",28),a()),i&2){let e=p();r(),c("ngForOf",e.barbers())}}function $e(i,t){if(i&1){let e=v();o(0,"app-time-slots",31),f("select",function(l){_(e);let d=p();return b(d.onPickSlot(l))}),a()}if(i&2){let e=t.ngIf,n=p();c("date",e)("slots",n.slots())("selected",n.selectedSlot()||void 0)("timezone","Europe/Lisbon")("locale","pt-PT")("loading",n.loadingSlots())}}function Ae(i,t){i&1&&(o(0,"span"),s(1,"Confirmar marca\xE7\xE3o"),a())}function Ye(i,t){i&1&&(o(0,"span"),s(1,"A confirmar\u2026"),a())}var _e=class i{api=D(me);auth=D(ae);router=D(oe);route=D(ie);submitting=g(!1);loadingServices=g(!0);loadingBarbers=g(!0);loadingSlots=g(!1);notes="";services=g([]);barbers=g([]);selectedServiceId=g(null);selectedBarberId=g(null);todayYmd=Ve(new Date);month=g(this.todayYmd.slice(0,7));selectedDate=g(this.todayYmd);slots=g([]);selectedSlot=g(null);note=g(null);ngOnInit(){let t=this.api.getBarbers().pipe(j(n=>n.filter(l=>l.active)),F(()=>this.loadingBarbers.set(!1))),e=this.api.getServices().pipe(j(n=>n.filter(l=>l.active)),F(()=>this.loadingServices.set(!1)));Q([t,e]).subscribe(([n,l])=>{this.barbers.set(n),this.services.set(l);let d=this.route.snapshot.queryParamMap,H=Number(d.get("servico")),V=Number(d.get("barbeiro")),P=l.find(u=>u.id===H)?.id??l[0]?.id??null,T=n.find(u=>u.id===V)?.id??n[0]?.id??null;this.selectedServiceId.set(P),this.selectedBarberId.set(T),this.selectedSlot.set(null),this.loadAvailability()})}onMonthChange(t){this.month.set(t)}onSelectDate(t){this.selectedDate.set(t),this.selectedSlot.set(null),this.loadAvailability()}onPickSlot(t){this.selectedSlot.set(t),this.note.set(null)}loadAvailability(){let t=this.selectedBarberId(),e=this.selectedServiceId(),n=this.selectedDate();!t||!e||!n||(this.loadingSlots.set(!0),this.api.getAvailability(t,e,n).subscribe({next:l=>{this.slots.set(l),this.loadingSlots.set(!1)},error:()=>{this.slots.set([]),this.loadingSlots.set(!1)}}))}canSubmit=te(()=>!!this.selectedBarberId()&&!!this.selectedServiceId()&&!!this.selectedDate()&&!!this.selectedSlot());book(){if(!this.canSubmit())return;let t=this.auth.user;if(!t?.id){this.note.set("Tens de iniciar sess\xE3o para marcar.");return}this.submitting.set(!0),this.note.set(null),this.api.createAppointment({barberId:this.selectedBarberId(),serviceId:this.selectedServiceId(),clientId:Number(t.id),startsAt:this.selectedSlot(),notes:this.notes.trim()||void 0}).pipe(F(()=>this.submitting.set(!1))).subscribe({next:e=>{this.notes="",this.router.navigate(["/sucesso",e])},error:e=>{this.note.set(e?.status===409?"Esse hor\xE1rio ficou indispon\xEDvel. Escolhe outro, por favor.":e?.message||"N\xE3o foi poss\xEDvel criar a marca\xE7\xE3o."),console.error("Falha ao criar marca\xE7\xE3o:",e)}})}onPickService(t){this.selectedServiceId()!==t&&(this.selectedServiceId.set(t),this.selectedSlot.set(null),this.loadAvailability())}onPickBarber(t){this.selectedBarberId()!==t&&(this.selectedBarberId.set(t),this.selectedSlot.set(null),this.loadAvailability())}getServiceImg(t){let e=t.name.toLowerCase();return e.includes("corte e barba")?"assets/services/corte-barba.png":e.includes("barba")?"assets/services/barba.png":e.includes("crian")?"assets/services/crianca.png":e.includes("corte")?"assets/services/corte.png":"assets/services/servico.png"}getBarberImg(t){return`assets/barbers/${t.id}.png`}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=S({type:i,selectors:[["app-booking"]],decls:28,vars:16,consts:[[1,"booking"],[1,"muted"],[1,"section-title"],["class","loading-grid",4,"ngIf"],["class","cards",4,"ngIf"],[1,"grid-2"],[3,"monthChange","selectDate","month","selectedDate","minDate","disableSundays"],[3,"date","slots","selected","timezone","locale","loading","select",4,"ngIf"],[1,"note-field"],["for","note"],["id","note","rows","2","maxlength","200","placeholder","Ex.: prefiro degrad\xEA, aten\xE7\xE3o \xE0 pele sens\xEDvel...",3,"ngModelChange","ngModel"],[1,"charcount"],[1,"actions"],[1,"btn","accent","cta",3,"click","disabled"],[4,"ngIf"],[1,"loading-grid"],["class","loading-card",4,"ngFor","ngForOf"],[1,"loading-card"],[1,"skeleton-avatar"],[1,"skeleton-text","short"],[1,"skeleton-text","medium"],[1,"cards"],["type","button","class","card service",3,"selected","click",4,"ngFor","ngForOf"],["type","button",1,"card","service",3,"click"],[1,"thumb",3,"src","alt"],[1,"card-body"],[1,"card-title"],[1,"card-meta"],["type","button","class","card barber",3,"selected","click",4,"ngFor","ngForOf"],["type","button",1,"card","barber",3,"click"],[1,"avatar",3,"src","alt"],[3,"select","date","slots","selected","timezone","locale","loading"]],template:function(e,n){e&1&&(o(0,"section",0)(1,"h1"),s(2,"Fazer marca\xE7\xE3o"),a(),o(3,"p",1),s(4,"Escolhe o servi\xE7o, o barbeiro e reserva rapidamente no calend\xE1rio."),a(),o(5,"h3",2),s(6,"Escolhe o servi\xE7o"),a(),m(7,we,2,2,"div",3)(8,Te,2,1,"div",4),o(9,"h3",2),s(10,"Escolhe o barbeiro"),a(),m(11,Fe,2,2,"div",3)(12,Ne,2,1,"div",4),o(13,"div",5)(14,"app-calendar-month",6),f("monthChange",function(d){return n.onMonthChange(d)})("selectDate",function(d){return n.onSelectDate(d)}),a(),m(15,$e,1,6,"app-time-slots",7),a(),o(16,"div",8)(17,"label",9),s(18,"Notas "),o(19,"span",1),s(20,"(opcional)"),a()(),o(21,"textarea",10),Z("ngModelChange",function(d){return X(n.notes,d)||(n.notes=d),d}),a(),o(22,"div",11),s(23),a()(),o(24,"div",12)(25,"button",13),f("click",function(){return n.book()}),m(26,Ae,2,0,"span",14)(27,Ye,2,0,"span",14),a()()()),e&2&&(r(7),c("ngIf",n.loadingServices()),r(),c("ngIf",!n.loadingServices()),r(3),c("ngIf",n.loadingBarbers()),r(),c("ngIf",!n.loadingBarbers()),r(2),c("month",n.month())("selectedDate",n.selectedDate()||void 0)("minDate",n.todayYmd)("disableSundays",!0),r(),c("ngIf",n.selectedDate()),r(6),K("ngModel",n.notes),r(2),C("",(n.notes||"").length,"/200"),r(2),h("loading",n.submitting()),c("disabled",!n.canSubmit()||n.submitting()),r(),c("ngIf",!n.submitting()),r(),c("ngIf",n.submitting()))},dependencies:[M,x,z,ne,de,re,se,ce,le,A,Y],styles:['.grid2[_ngcontent-%COMP%]{display:grid;grid-template-columns:1.1fr 1fr;gap:1rem}@media (max-width: 1020px){.grid2[_ngcontent-%COMP%]{grid-template-columns:1fr}}.form[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{margin-top:.2rem}.row[_ngcontent-%COMP%]{display:flex;gap:1rem;flex-wrap:wrap}.field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem;min-width:220px}.grid-2[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem}.actions[_ngcontent-%COMP%]{margin-top:4rem}.welcome[_ngcontent-%COMP%]{margin-left:.5rem}.section-title[_ngcontent-%COMP%]{margin:1rem 0 .5rem;font-size:1.1rem}.cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:.75rem;margin-bottom:1rem}.card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem;border:2px solid transparent;border-radius:16px;background:#111;cursor:pointer;transition:transform .12s ease,border-color .12s ease,box-shadow .12s ease;text-align:left}.card[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}.card.selected[_ngcontent-%COMP%]{border-color:#c3ff5a;box-shadow:0 0 0 4px #c3ff5a26;background:#141914}.card[_ngcontent-%COMP%]   .thumb[_ngcontent-%COMP%]{width:42px;height:42px;object-fit:contain}.card[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:42px;height:42px;border-radius:999px;object-fit:cover;background:#222}.card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.card[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{font-weight:600}.card[_ngcontent-%COMP%]   .card-meta[_ngcontent-%COMP%]{font-size:.85rem;color:#aaa}.grid-2[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;align-items:start;justify-items:stretch;margin-bottom:4rem}@media (max-width: 900px){.grid-2[_ngcontent-%COMP%]{grid-template-columns:1fr}}.booking[_ngcontent-%COMP%]{padding-bottom:4rem}.booking[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:1.5rem 0 3rem}.btn.cta[_ngcontent-%COMP%]{padding:1.1rem 1.8rem;font-size:1.1rem;font-weight:800;letter-spacing:.2px;border-radius:14px;min-width:240px;-webkit-font-smoothing:antialiased;transition:transform .12s ease,box-shadow .15s ease,filter .2s ease}.btn.accent.cta[_ngcontent-%COMP%]{background:var(--accent);color:#111;border:0;box-shadow:0 10px 24px #c3ff5a40}.btn.accent.cta[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 14px 32px #c3ff5a4d}.btn.accent.cta[_ngcontent-%COMP%]:active{transform:translateY(0)}.btn.accent.cta[_ngcontent-%COMP%]:disabled{cursor:not-allowed;filter:grayscale(.6);opacity:.7;box-shadow:none}.btn.cta[_ngcontent-%COMP%]{font-family:Manrope,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Noto Sans,Arial,"Apple Color Emoji","Segoe UI Emoji"}.note-field[_ngcontent-%COMP%]{margin-top:1rem;display:grid;gap:.4rem}.note-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:vertical;min-height:64px}.note-field[_ngcontent-%COMP%]   .charcount[_ngcontent-%COMP%]{text-align:right;font-size:.85rem;color:var(--muted)}']})};function Ve(i){let t=i.getFullYear(),e=String(i.getMonth()+1).padStart(2,"0"),n=String(i.getDate()).padStart(2,"0");return`${t}-${e}-${n}`}export{_e as BookingComponent};
