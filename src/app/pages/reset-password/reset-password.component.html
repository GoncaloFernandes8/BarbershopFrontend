<section class="reset-password">
  <div class="card">
    <div class="header">
      <h1>Redefinir password</h1>
      <p class="muted">Cria uma nova password segura para a tua conta.</p>
    </div>

    <form [formGroup]="form" (ngSubmit)="submit()" class="form">
      <!-- Password -->
      <div class="field pwd">
        <label for="password" class="pwd-label">
          Nova password
          <button type="button"
                  class="pwd-emoji-btn"
                  (click)="showPassword.set(!showPassword())"
                  [attr.aria-label]="showPassword() ? 'Ocultar password' : 'Mostrar password'">
            <img [src]="showPassword() ? 'assets/feliz.png' : 'assets/taparolho.png'"
                 alt=""
                 class="pwd-icon" />
          </button>
        </label>
        <input 
          id="password"
          [type]="showPassword() ? 'text' : 'password'"
          formControlName="password"
          autocomplete="new-password"
          placeholder="Mínimo 8 caracteres"
          required />
        
        <!-- Indicador de força -->
        <div class="strength-indicator" *ngIf="f.password.value">
          <div class="strength-bar" [class.weak]="passwordStrength === 'weak'"
                                     [class.medium]="passwordStrength === 'medium'"
                                     [class.strong]="passwordStrength === 'strong'"></div>
          <span class="strength-label">
            <ng-container [ngSwitch]="passwordStrength">
              <span *ngSwitchCase="'weak'" class="weak">Fraca</span>
              <span *ngSwitchCase="'medium'" class="medium">Média</span>
              <span *ngSwitchCase="'strong'" class="strong">Forte</span>
            </ng-container>
          </span>
        </div>

        <div class="error" *ngIf="f.password.touched && f.password.invalid">
          A password deve ter pelo menos 8 caracteres.
        </div>
      </div>

      <!-- Confirmar Password -->
      <div class="field pwd">
        <label for="confirmPassword" class="pwd-label">
          Confirmar password
          <button type="button"
                  class="pwd-emoji-btn"
                  (click)="showConfirmPassword.set(!showConfirmPassword())"
                  [attr.aria-label]="showConfirmPassword() ? 'Ocultar password' : 'Mostrar password'">
            <img [src]="showConfirmPassword() ? 'assets/feliz.png' : 'assets/taparolho.png'"
                 alt=""
                 class="pwd-icon" />
          </button>
        </label>
        <input 
          id="confirmPassword"
          [type]="showConfirmPassword() ? 'text' : 'password'"
          formControlName="confirmPassword"
          autocomplete="new-password"
          placeholder="Repete a password"
          required />
        
        <div class="match-indicator" *ngIf="f.confirmPassword.value">
          <span *ngIf="passwordsMatch" class="match">✓ As passwords coincidem</span>
          <span *ngIf="!passwordsMatch" class="no-match">✗ As passwords não coincidem</span>
        </div>

        <div class="error" *ngIf="f.confirmPassword.touched && f.confirmPassword.invalid">
          Por favor, confirma a password.
        </div>
      </div>

      <!-- Botão -->
      <div class="actions">
        <button type="submit" class="btn accent" [disabled]="loading() || form.invalid || !passwordsMatch">
          {{ loading() ? 'A redefinir...' : 'Redefinir password' }}
        </button>
        <button type="button" class="btn ghost" (click)="router.navigate(['/login'])" [disabled]="loading()">
          Voltar ao login
        </button>
      </div>
    </form>
  </div>
</section>

