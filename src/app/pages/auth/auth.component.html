<section class="auth card">
  <div class="tabs">
    <button class="tab" [class.active]="activeTab()==='login'" (click)="switch('login')">{{ lang.t('auth.login_tab') }}</button>
    <button class="tab" [class.active]="activeTab()==='register'" (click)="switch('register')">{{ lang.t('auth.register_tab') }}</button>
  </div>

  <!-- Só aparece quando o backend respondeu EMAIL_NOT_VERIFIED -->
<div *ngIf="pendingEmail()" class="resend">
  <button type="button"
          class="btn small"
          (click)="resendVerification()"
          [disabled]="resending()">
    {{ resending() ? lang.t('common.resending') : lang.t('auth.resend_verification') }}
  </button>
  <span class="muted small" style="margin-left:.5rem">
    {{ lang.t('auth.to') }} {{ pendingEmail() }}
  </span>
</div>

  <!-- LOGIN -->
  <form *ngIf="activeTab()==='login'"
        [formGroup]="loginForm"
        (ngSubmit)="submitLogin()"
        class="form">

    <div class="field">
      <label for="lemail">{{ lang.t('auth.email_label') }}</label>
      <input id="lemail"
             type="email"
             formControlName="email"
             autocomplete="email"
             required />
      <div class="error" *ngIf="lf.email.touched && lf.email.invalid">
        {{ lang.t('auth.email_error') }}
      </div>
    </div>

    <div class="field pwd">
      <label for="lpass" class="pwd-label">
        {{ lang.t('auth.password_label') }}
        <button type="button"
                class="pwd-emoji-btn"
                (click)="showPwdLogin.set(!showPwdLogin())"
                [attr.aria-pressed]="showPwdLogin()"
                [attr.aria-controls]="'lpass'"
                [attr.aria-label]="showPwdLogin() ? lang.t('auth.hide_password') : lang.t('auth.show_password')">
          <img [src]="showPwdLogin() ? 'assets/feliz.png' : 'assets/taparolho.png'"
               alt=""
               class="pwd-icon" />
        </button>
      </label>

      <input id="lpass"
             [type]="showPwdLogin() ? 'text' : 'password'"
             formControlName="password"
             autocomplete="current-password"
             required />
      <div class="error" *ngIf="lf.password.touched && lf.password.invalid">
        {{ lang.t('auth.password_error') }}
      </div>
    </div>

    <!-- opcional: lembrar sessão -->
    <!--
    <label class="checkbox small">
      <input type="checkbox" formControlName="remember" />
      Lembrar-me neste dispositivo
    </label>
    -->

    <div class="actions">
      <button class="btn accent" type="submit" [disabled]="loading()">
        {{ loading() ? lang.t('common.entering') : lang.t('auth.login_button') }}
      </button>
      <button type="button" class="btn ghost small" (click)="openForgotPasswordModal()">
        Esqueci-me da password
      </button>
    </div>
  </form>

  <!-- REGISTAR -->
  <form *ngIf="activeTab()==='register'"
        [formGroup]="registerForm"
        (ngSubmit)="submitRegister()"
        class="form">

    <div class="field">
      <label for="rname">{{ lang.t('auth.name_label') }}</label>
      <input id="rname" type="text" formControlName="name" autocomplete="name" required />
      <div class="error" *ngIf="rf.name.touched && rf.name.invalid">
        {{ lang.t('auth.name_error') }}
      </div>
    </div>

    <div class="field">
      <label for="rphone">{{ lang.t('auth.phone_label') }}</label>
      <input id="rphone" type="tel" formControlName="phone" autocomplete="tel" required />
      <div class="error" *ngIf="rf.phone.touched && rf.phone.invalid">
        {{ lang.t('auth.phone_error') }}
      </div>
    </div>

    <div class="field">
      <label for="remail">{{ lang.t('auth.email_label') }}</label>
      <input id="remail" type="email" formControlName="email" autocomplete="email" required />
      <div class="error" *ngIf="rf.email.touched && rf.email.invalid">
        {{ lang.t('auth.email_error') }}
      </div>
    </div>

    <div class="field pwd">
      <label for="rpass" class="pwd-label">
        {{ lang.t('auth.password_label') }}
        <button type="button"
                class="pwd-emoji-btn"
                (click)="showPwdReg.set(!showPwdReg())"
                [attr.aria-pressed]="showPwdReg()"
                [attr.aria-controls]="'rpass'"
                [attr.aria-label]="showPwdReg() ? lang.t('auth.hide_password') : lang.t('auth.show_password')">
          <img [src]="showPwdReg() ? 'assets/feliz.png' : 'assets/taparolho.png'"
               alt=""
               class="pwd-icon" />
        </button>
      </label>

      <input id="rpass"
             [type]="showPwdReg() ? 'text' : 'password'"
             formControlName="password"
             autocomplete="new-password"
             required />
      <div class="error" *ngIf="rf.password.touched && rf.password.invalid">
        {{ lang.t('auth.password_error') }}
      </div>
    </div>

    <div class="actions">
      <button class="btn accent" type="submit" [disabled]="loading()">
        {{ loading() ? lang.t('common.sending') : lang.t('auth.register_button') }}
      </button>
      <button type="button" class="btn ghost" (click)="switch('login')">{{ lang.t('auth.already_have_account') }}</button>
    </div>
  </form>
</section>

<!-- MODAL: Esqueci-me da password -->
<div class="modal-overlay" *ngIf="showForgotPasswordModal()" (click)="closeForgotPasswordModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Recuperar password</h2>
      <button type="button" class="modal-close" (click)="closeForgotPasswordModal()" aria-label="Fechar">×</button>
    </div>
    <div class="modal-body">
      <p class="muted">Insere o teu email e enviaremos instruções para redefinires a tua password.</p>
      <div class="field">
        <label for="forgot-email">Email</label>
        <input 
          id="forgot-email" 
          type="email" 
          [(ngModel)]="forgotPasswordEmail"
          placeholder="exemplo@email.com"
          [disabled]="sendingResetEmail()"
          (keyup.enter)="sendResetEmail()" />
      </div>
    </div>
    <div class="modal-actions">
      <button type="button" class="btn ghost" (click)="closeForgotPasswordModal()" [disabled]="sendingResetEmail()">
        Cancelar
      </button>
      <button type="button" class="btn accent" (click)="sendResetEmail()" [disabled]="sendingResetEmail()">
        {{ sendingResetEmail() ? 'A enviar...' : 'Enviar instruções' }}
      </button>
    </div>
  </div>
</div>
