<section class="booking">
  <h1>Fazer marcação</h1>
  <p class="muted">Escolhe o serviço, o barbeiro e reserva rapidamente no calendário.</p>

  <!-- SERVIÇOS -->
  <h3 class="section-title">Escolhe o serviço</h3>
  
  <!-- Loading state para serviços -->
  <div class="loading-grid" *ngIf="loadingServices()">
    <div class="loading-card" *ngFor="let item of [1,2,3]">
      <div class="skeleton-avatar"></div>
      <div class="skeleton-text short"></div>
      <div class="skeleton-text medium"></div>
    </div>
  </div>
  
  <!-- Lista de serviços -->
  <div class="cards" *ngIf="!loadingServices()">
    <button
      type="button"
      class="card service"
      *ngFor="let s of services()"
      [class.selected]="selectedServiceId() === s.id"
      (click)="onPickService(s.id)"
      [attr.aria-pressed]="selectedServiceId() === s.id ? 'true' : 'false'"
    >
      <img class="thumb" [src]="getServiceImg(s)" [alt]="s.name" />
      <div class="card-body">
        <div class="card-title">{{ s.name }}</div>
        <div class="card-meta">
          {{ s.durationMin }} min · {{ (s.priceCents/100) | number:'1.2-2':'pt-PT' }} €
        </div>
      </div>
    </button>
  </div>

  <!-- BARBEIROS -->
  <h3 class="section-title">Escolhe o barbeiro</h3>
  
  <!-- Loading state para barbeiros -->
  <div class="loading-grid" *ngIf="loadingBarbers()">
    <div class="loading-card" *ngFor="let item of [1,2]">
      <div class="skeleton-avatar"></div>
      <div class="skeleton-text short"></div>
      <div class="skeleton-text medium"></div>
    </div>
  </div>
  
  <!-- Lista de barbeiros -->
  <div class="cards" *ngIf="!loadingBarbers()">
    <button
      type="button"
      class="card barber"
      *ngFor="let b of barbers()"
      [class.selected]="selectedBarberId() === b.id"
      (click)="onPickBarber(b.id)"
      [attr.aria-pressed]="selectedBarberId() === b.id ? 'true' : 'false'"
    >
      <img class="avatar" [src]="getBarberImg(b)" [alt]="b.name" />
      <div class="card-body">
        <div class="card-title">{{ b.name }}</div>
        <div class="card-meta">Barbeiro</div>
      </div>
    </button>
  </div>

  <!-- CALENDÁRIO + SLOTS -->
  <div class="grid-2">
    <app-calendar-month
      [month]="month()"
      [selectedDate]="selectedDate() || undefined"
      [minDate]="todayYmd"
      [disableSundays]="true"
      (monthChange)="onMonthChange($event)"
      (selectDate)="onSelectDate($event)">
    </app-calendar-month>

    <app-time-slots
      *ngIf="selectedDate() as ymd"
      [date]="ymd"
      [slots]="slots()"
      [selected]="selectedSlot() || undefined"
      [timezone]="'Europe/Lisbon'"
      [locale]="'pt-PT'"
      [loading]="loadingSlots()"
      (select)="onPickSlot($event)">
    </app-time-slots>
  </div>

  <!-- NOTAS -->
<div class="note-field">
  <label for="note">Notas <span class="muted">(opcional)</span></label>
  <textarea id="note"
            [(ngModel)]="notes"
            rows="2"
            maxlength="200"
            placeholder="Ex.: prefiro degradê, atenção à pele sensível..."></textarea>
  <div class="charcount">{{ (notes || '').length }}/200</div>
</div>


  <div class="actions">
    <button class="btn accent cta"
            (click)="book()"
            [disabled]="!canSubmit() || submitting()">
      <span *ngIf="!submitting()">Confirmar marcação</span>
      <span *ngIf="submitting()">A confirmar…</span>
    </button>
  </div>

</section>
