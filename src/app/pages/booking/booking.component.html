<section class="booking">
  <h1>Fazer marcação</h1>
  <p class="muted">Escolhe o serviço, barbeiro e reserva rapidamente no calendário.</p>

  <div class="filters row">
    <label class="field">
      <span>Serviço</span>
      <select [(ngModel)]="selectedServiceId" (ngModelChange)="loadAvailability()">
        <option *ngFor="let s of services()" [ngValue]="s.id">
          {{ s.name }} ({{ s.durationMin }} min)
        </option>
      </select>
    </label>

    <label class="field">
      <span>Barbeiro</span>
      <select [(ngModel)]="selectedBarberId" (ngModelChange)="loadAvailability()">
        <option *ngFor="let b of barbers()" [ngValue]="b.id">
          {{ b.name }}
        </option>
      </select>
    </label>
  </div>

  <div class="grid-2">
    <app-calendar-month
      [month]="month()"
      [selectedDate]="selectedDate() || undefined"
      [minDate]="todayYmd"
      [disableSundays]="true"
      (monthChange)="onMonthChange($event)"
      (selectDate)="onSelectDate($event)">
    </app-calendar-month>

    <app-time-slots
  *ngIf="selectedDate() as ymd"
  [date]="ymd"
  [slots]="slots()"
  [selected]="selectedSlot() || undefined"
  [timezone]="'Europe/Lisbon'"
  [locale]="'pt-PT'"
  [loading]="loadingSlots()"
  (select)="onPickSlot($event)">
</app-time-slots>
  </div>

  <p class="error" *ngIf="note()">{{ note() }}</p>

  <div class="actions">
    <button class="btn accent" (click)="book()" [disabled]="!canSubmit()">Confirmar marcação</button>
  </div>
</section>
